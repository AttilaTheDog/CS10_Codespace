#!/bin/bash

PORT="8080"
export RSTUDIO_CONFIG_DIR="/etc/opt/rstudio" # https://docs.posit.co/ide/desktop-pro/settings/settings.html
export USER="${USER:-$(whoami)}"

# Kill any process listing on the specified port
fuser --kill -TERM "${PORT}/tcp" &>/dev/null

# Start server
echo "Available on:"
echo "  http://0.0.0.0:${PORT}"
echo "Hit CTRL-C to stop the server"
/usr/lib/rstudio-server/bin/rserver \
    --auth-none=1 \
    --database-config-file=/etc/opt/rstudio-server/database.conf \
    --server-daemonize=0 \
    --server-data-dir=/tmp \
    --server-user="$USER" \
    --www-port=${PORT} 2> /dev/null
