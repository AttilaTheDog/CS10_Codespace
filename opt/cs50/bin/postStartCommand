#!/bin/bash

# Start Docker outside of Docker
sudo /etc/init.d/docker start > /dev/null 2>&1

# Impose CPU limit on Docker (will be removed after pulling images)
nohup bash -c "sudo cpulimit --pid=$(pidof dockerd) --limit=30 &" > /dev/null 2>&1

# Loop through the array and pull each image in background
nohup bash -c '
(docker_images=(
    "cs50/cli:amd64"
    "rocker/tidyverse"
)
for image in "${docker_images[@]}"; do
    docker pull "$image" > /dev/null 2>&1
done
docker image prune --force
kill $(pidof cpulimit)
) &' > /dev/null 2>&1
